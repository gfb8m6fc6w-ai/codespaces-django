<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¨Ù„ÙŠØ§Ø±Ø¯Ùˆ Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</title>
    <link rel="manifest" href="manifest.json">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 100%);
            color: #eee;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .calculator {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
        }

        .calculator h1 {
            color: #16c784;
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.8em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #16c784;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-calculate {
            background: #16c784;
            color: white;
            grid-column: 1 / -1;
        }

        .btn-calculate:hover {
            background: #12a367;
            transform: scale(1.02);
        }

        .btn-clear {
            background: #e94560;
            color: white;
        }

        .btn-clear:hover {
            background: #d63347;
        }

        .btn-export {
            background: #0066cc;
            color: white;
        }

        .btn-export:hover {
            background: #0052a3;
        }

        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f0f0f0;
            border-radius: 8px;
            display: none;
            border-left: 4px solid #16c784;
        }

        .result.visible {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .result h3 {
            color: #16c784;
            margin-bottom: 15px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: bold;
            color: #333;
        }

        .result-value {
            color: #16c784;
            font-weight: bold;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 600px) {
            .calculator {
                padding: 20px;
            }

            .calculator h1 {
                font-size: 1.4em;
            }

            .input-row {
                grid-template-columns: 1fr;
            }

            .button-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="calculator">
        <h1>ğŸ§® Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¨Ù„ÙŠØ§Ø±Ø¯Ùˆ</h1>

        <div class="input-group">
            <label for="rails">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø¯Ø±Ø§Ù† (1-4)</label>
            <input type="number" id="rails" min="1" max="4" value="2" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†">
        </div>

        <div class="input-group">
            <label for="whiteBall">Ù…ÙˆØ¶Ø¹ Ø§Ù„ÙƒØ±Ø© Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ (0-10)</label>
            <input type="number" id="whiteBall" min="0" max="10" step="0.1" value="5" placeholder="0.0 - 10.0">
        </div>

        <div class="input-group">
            <label for="target">Ù…ÙˆØ¶Ø¹ Ø§Ù„Ù‡Ø¯Ù (0-10)</label>
            <input type="number" id="target" min="0" max="10" step="0.1" value="5" placeholder="0.0 - 10.0">
        </div>

        <div class="input-group">
            <label for="angle">Ø§Ù„Ø²Ø§ÙˆÙŠØ© (-90 Ø¥Ù„Ù‰ 90)</label>
            <input type="number" id="angle" min="-90" max="90" value="0" placeholder="-90 Ø¥Ù„Ù‰ 90">
        </div>

        <div class="input-group">
            <label for="power">Ø§Ù„Ù‚ÙˆØ© (0-100)</label>
            <input type="number" id="power" min="0" max="100" value="50" placeholder="0 - 100">
        </div>

        <div class="input-group">
            <label for="distance">Ø§Ù„Ù…Ø³Ø§ÙØ© (Ø³Ù…)</label>
            <input type="number" id="distance" min="0" value="100" placeholder="0+">
        </div>

        <div class="input-group">
            <label for="difficulty">Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØµØ¹ÙˆØ¨Ø©</label>
            <select id="difficulty">
                <option value="0">Ø³Ù‡Ù„ Ø¬Ø¯Ø§Ù‹ (1.5x)</option>
                <option value="1">Ø³Ù‡Ù„ (1.2x)</option>
                <option value="2" selected>Ù…ØªÙˆØ³Ø· (1.0x)</option>
                <option value="3">ØµØ¹Ø¨ (0.8x)</option>
                <option value="4">ØµØ¹Ø¨ Ø¬Ø¯Ø§Ù‹ (0.6x)</option>
                <option value="5">Ø§Ø­ØªØ±Ø§ÙÙŠ (0.4x)</option>
            </select>
        </div>

        <div class="button-group">
            <button class="btn-calculate" onclick="calculateResult()">ğŸ§® Ø§Ø­Ø³Ø¨</button>
            <button class="btn-clear" onclick="clearForm()">ğŸ”„ Ù…Ø³Ø­</button>
            <button class="btn-export" onclick="exportResult()" style="grid-column: 1 / -1;">ğŸ“¥ ØªØµØ¯ÙŠØ±</button>
        </div>

        <div class="result" id="result">
            <h3>ğŸ“Š Ø§Ù„Ù†ØªÙŠØ¬Ø©</h3>
            <div class="result-item">
                <span class="result-label">Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</span>
                <span class="result-value" id="expectedValue">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­:</span>
                <span class="result-value" id="successRate">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">Ø§Ù„ØªÙ‚ÙŠÙŠÙ…:</span>
                <span class="result-value" id="rating">-</span>
            </div>
            <div class="result-item">
                <span class="result-label">Ø§Ù„ØªÙˆØµÙŠØ©:</span>
                <span class="result-value" id="recommendation">-</span>
            </div>
        </div>
    </div>

    <script src="js/system-services.js"></script>
    <script>
        function calculateResult() {
            const rails = parseInt(document.getElementById('rails').value);
            const whiteBall = parseFloat(document.getElementById('whiteBall').value);
            const target = parseFloat(document.getElementById('target').value);
            const angle = parseFloat(document.getElementById('angle').value);
            const power = parseFloat(document.getElementById('power').value);
            const distance = parseFloat(document.getElementById('distance').value);
            const difficulty = parseInt(document.getElementById('difficulty').value);

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµØ­Ø©
            if (isNaN(whiteBall) || isNaN(target) || isNaN(angle) || isNaN(power) || isNaN(distance)) {
                NotificationManager.show('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­', 'error');
                return;
            }

            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©
            const expectedValue = (whiteBall + target).toFixed(1);

            // Ø­Ø³Ø§Ø¨ Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
            const angleFactor = 100 - (Math.abs(angle) * 0.5);
            let powerFactor = power >= 40 && power <= 80 ? 100 : 60;
            let distanceFactor = distance <= 50 ? 100 : Math.max(0, 100 - (distance - 50) * 0.1);
            
            const difficultyFactors = [1.5, 1.2, 1.0, 0.8, 0.6, 0.4];
            const baseSuccess = (angleFactor * 0.25 + powerFactor * 0.25 + distanceFactor * 0.25 + 25) * difficultyFactors[difficulty];
            const successRate = Math.max(0, Math.min(100, baseSuccess)).toFixed(1);

            // Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
            let rating, recommendation;
            if (successRate >= 80) {
                rating = 'â­â­â­â­â­ Ù…Ù…ØªØ§Ø²';
                recommendation = 'ØªØ³Ø¯ÙŠØ¯Ø© Ø³Ù‡Ù„Ø© Ø¬Ø¯Ø§Ù‹ - Ø§Ù†Ø·Ù„Ù‚ Ø¨Ø«Ù‚Ø©!';
            } else if (successRate >= 60) {
                rating = 'â­â­â­â­ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹';
                recommendation = 'ØªØ³Ø¯ÙŠØ¯Ø© Ø¬ÙŠØ¯Ø© - Ù„Ø¯ÙŠÙƒ ÙØ±ØµØ© Ø¹Ø§Ù„ÙŠØ©';
            } else if (successRate >= 40) {
                rating = 'â­â­â­ Ø¬ÙŠØ¯';
                recommendation = 'ØªØ³Ø¯ÙŠØ¯Ø© Ù…ØªÙˆØ³Ø·Ø© - ÙƒÙ† Ø­Ø°Ø±Ø§Ù‹';
            } else if (successRate >= 20) {
                rating = 'â­â­ Ø¶Ø¹ÙŠÙ';
                recommendation = 'ØªØ³Ø¯ÙŠØ¯Ø© ØµØ¹Ø¨Ø© Ø¬Ø¯Ø§Ù‹ - ÙÙƒÙ‘Ø± Ø¬ÙŠØ¯Ø§Ù‹';
            } else {
                rating = 'â­ ØµØ¹Ø¨ Ø¬Ø¯Ø§Ù‹';
                recommendation = 'ØªØ³Ø¯ÙŠØ¯Ø© Ø´Ø¨Ù‡ Ù…Ø³ØªØ­ÙŠÙ„Ø© - Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¨Ø¯ÙŠÙ„';
            }

            // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            document.getElementById('expectedValue').textContent = expectedValue;
            document.getElementById('successRate').textContent = successRate + '%';
            document.getElementById('rating').textContent = rating;
            document.getElementById('recommendation').textContent = recommendation;
            document.getElementById('result').classList.add('visible');

            NotificationManager.show('âœ… ØªÙ… Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function clearForm() {
            document.getElementById('rails').value = 2;
            document.getElementById('whiteBall').value = 5;
            document.getElementById('target').value = 5;
            document.getElementById('angle').value = 0;
            document.getElementById('power').value = 50;
            document.getElementById('distance').value = 100;
            document.getElementById('difficulty').value = 2;
            document.getElementById('result').classList.remove('visible');
        }

        function exportResult() {
            const data = {
                rails: document.getElementById('rails').value,
                whiteBall: document.getElementById('whiteBall').value,
                target: document.getElementById('target').value,
                angle: document.getElementById('angle').value,
                power: document.getElementById('power').value,
                distance: document.getElementById('distance').value,
                difficulty: document.getElementById('difficulty').value,
                expectedValue: document.getElementById('expectedValue').textContent,
                successRate: document.getElementById('successRate').textContent,
                rating: document.getElementById('rating').textContent,
                recommendation: document.getElementById('recommendation').textContent,
                timestamp: new Date().toISOString()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `billiards-calculation-${Date.now()}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            NotificationManager.show('âœ… ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ù†ØªÙŠØ¬Ø©', 'success');
        }

        // ØªØ³Ø¬ÙŠÙ„ Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js').then(
                () => console.log('âœ… Service Worker Ù…Ø³Ø¬Ù„'),
                () => console.log('âš ï¸ Service Worker Ù„Ù… ÙŠØ³Ø¬Ù„')
            );
        }
    </script>
</body>
</html>
