<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù„ÙŠØ§Ø±Ø¯Ùˆ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„ - Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…ÙˆØ­Ø¯Ø©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --light: #f8f9fa;
            --dark: #333;
            --border: #ddd;
            --shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        body {
            font-family: 'Cairo', 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            min-height: 100vh;
            color: var(--dark);
        }

        /* ==========================================
           Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ù„Ù„ØªØ·Ø¨ÙŠÙ‚
        ========================================== */

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header.app-header {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        header h1 {
            color: var(--primary);
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        header .controls {
            display: flex;
            gap: 10px;
        }

        /* ==========================================
           Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ù‚Ù„
        ========================================== */

        nav.main-nav {
            background: white;
            border-radius: 10px;
            padding: 0;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            gap: 0;
            overflow: hidden;
        }

        nav button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            color: var(--dark);
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        nav button:hover {
            background: var(--light);
            color: var(--primary);
        }

        nav button.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: var(--light);
        }

        /* ==========================================
           Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        ========================================== */

        .content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: var(--shadow);
        }

        .content.hidden {
            display: none;
        }

        .card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border-right: 4px solid var(--primary);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        /* ==========================================
           Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
        ========================================== */

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
        }

        input[type="number"],
        input[type="text"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border);
            border-radius: 5px;
            font-family: inherit;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 5px rgba(102, 126, 234, 0.3);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        /* ==========================================
           Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        ========================================== */

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: var(--info);
            color: white;
        }

        .btn-secondary:hover {
            background: #138496;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* ==========================================
           Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
        ========================================== */

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--primary);
            color: white;
        }

        th {
            padding: 15px;
            text-align: right;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }

        tbody tr:hover {
            background: var(--light);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-correct {
            background: #d4edda;
            color: #155724;
        }

        .status-incorrect {
            background: #f8d7da;
            color: #721c24;
        }

        /* ==========================================
           Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ©
        ========================================== */

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.2em;
            font-weight: bold;
        }

        /* ==========================================
           Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ÙˆØ§Ù„ØªØ­Ù‚Ù‚
        ========================================== */

        .result-box {
            background: #f0f4ff;
            border-right: 4px solid var(--primary);
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        .result-value {
            font-size: 2.5em;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
            margin: 15px 0;
        }

        .validation-message {
            text-align: center;
            font-weight: 600;
            margin-top: 10px;
        }

        .validation-correct {
            color: var(--success);
        }

        .validation-incorrect {
            color: var(--danger);
        }

        /* ==========================================
           Ø§Ù„Ù…Ø±Ø´Ø­Ø§Øª ÙˆØ§Ù„Ø¨Ø­Ø«
        ========================================== */

        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
        }

        .filter-group label {
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        /* ==========================================
           Ø§Ù„Ø¥Ø®Ø·Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„
        ========================================== */

        .alert {
            padding: 15px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid var(--success);
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid var(--danger);
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 4px solid var(--info);
        }

        /* ==========================================
           Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙØ§Ø±ØºØ©
        ========================================== */

        .empty-message {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 1.1em;
        }

        /* ==========================================
           Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…ØªØ¬Ø§ÙˆØ¨
        ========================================== */

        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }

            header.app-header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            nav.main-nav {
                flex-wrap: wrap;
            }

            nav button {
                flex: 1;
                min-width: 100px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .btn-group {
                flex-wrap: wrap;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .filter-section {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.9em;
            }

            th, td {
                padding: 8px;
            }
        }

        /* ==========================================
           Ø§Ù„Ø­Ø±ÙƒØ§Øª ÙˆØ§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª
        ========================================== */

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes slideOut {
            from {
                opacity: 1;
                transform: translateX(0);
            }
            to {
                opacity: 0;
                transform: translateX(20px);
            }
        }

        /* ==========================================
           Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
        ========================================== */

        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #1a252f 100%);
        }

        body.dark-mode .content,
        body.dark-mode header.app-header,
        body.dark-mode nav.main-nav {
            background: #2c3e50;
            color: #ecf0f1;
        }

        body.dark-mode .card {
            background: #34495e;
            color: #ecf0f1;
        }

        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            background: #2c3e50;
            color: #ecf0f1;
            border-color: #555;
        }

        body.dark-mode .result-box {
            background: #34495e;
        }

        body.dark-mode thead {
            background: #34495e;
        }

        body.dark-mode tbody tr:hover {
            background: #34495e;
        }
    </style>
</head>
<body>
    <!-- Ø±Ø£Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
    <header class="app-header">
        <h1>ğŸ± Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨Ù„ÙŠØ§Ø±Ø¯Ùˆ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</h1>
        <div class="controls">
            <button id="themeToggle" class="btn-secondary">ğŸŒ™ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ</button>
            <button id="helpBtn" class="btn-secondary">â“ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©</button>
        </div>
    </header>

    <div class="app-container">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <nav class="main-nav">
            <button class="nav-btn active" data-mode="calculator">ğŸ§® Ø§Ù„Ø­Ø§Ø³Ø¨Ø©</button>
            <button class="nav-btn" data-mode="dashboard">ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
            <button class="nav-btn" data-mode="measurements">ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª</button>
            <button class="nav-btn" data-mode="settings">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </nav>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø®Ø·Ø§Ø±Ø§Øª -->
        <div id="alertContainer"></div>

        <!-- ==========================================
             Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
        ========================================== -->
        <div id="calculatorMode" class="content">
            <div class="card">
                <h2>ğŸ¯ Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø¨Ù„ÙŠØ§Ø±Ø¯Ùˆ</h2>
                <p>Ù‚ÙŠØ§Ø³ Ù…ÙƒØ§Ù† Ø§Ù„ØªØµÙˆÙŠØ¨ + Ù‚ÙŠØ§Ø³ Ù…ÙƒØ§Ù† Ø§Ù„ÙƒØ±Ù‡ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ = Ù‚ÙŠØ§Ø³ Ù…ÙƒØ§Ù† Ø§Ù„Ø¹ØµØ§</p>
            </div>

            <div class="card">
                <h2>ğŸ“¥ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h2>
                <form id="calculatorForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="rails">Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†</label>
                            <select id="rails" required>
                                <option value="">Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†</option>
                                <option value="1">1 Ø¬Ø¯Ø§Ø±</option>
                                <option value="2">2 Ø¬Ø¯Ø§Ø±</option>
                                <option value="3">3 Ø¬Ø¯Ø±Ø§Ù†</option>
                                <option value="4">4 Ø¬Ø¯Ø±Ø§Ù†</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="target">Ù…ÙƒØ§Ù† Ø§Ù„ØªØµÙˆÙŠØ¨</label>
                            <input type="number" id="target" step="0.1" placeholder="Ù…Ø«Ø§Ù„: 3.5" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="whiteBall">Ù‚ÙŠØ§Ø³ Ø§Ù„ÙƒØ±Ù‡ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡</label>
                            <input type="number" id="whiteBall" step="0.1" placeholder="Ù…Ø«Ø§Ù„: 2.5" required>
                        </div>
                        <div class="form-group">
                            <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                            <input type="text" id="notes" placeholder="Ø£Ø¶Ù Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©">
                        </div>
                    </div>

                    <button type="button" class="btn-primary" id="calculateBtn">Ø­Ø³Ø§Ø¨ Ù‚ÙŠØ§Ø³ Ø§Ù„Ø¹ØµØ§</button>
                </form>
            </div>

            <div class="card">
                <h2>ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
                <div class="result-box">
                    <div>Ù‚ÙŠØ§Ø³ Ø§Ù„Ø¹ØµØ§ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</div>
                    <div class="result-value" id="resultValue">-</div>
                    <div id="validationMessage" class="validation-message"></div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn-success" id="addBtn" style="display: none;">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¬Ø¯ÙˆÙ„</button>
                    <button type="button" class="btn-secondary" id="clearBtn">Ù…Ø³Ø­</button>
                </div>
            </div>
        </div>

        <!-- ==========================================
             Ù…Ø­ØªÙˆÙ‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        ========================================== -->
        <div id="dashboardMode" class="content hidden">
            <div class="card">
                <h2>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            </div>

            <div class="stats-grid" id="statsGrid"></div>

            <div class="card">
                <h2>ğŸ“ˆ Ø¢Ø®Ø± Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª</h2>
                <div class="table-container">
                    <table id="recentTable">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†</th>
                                <th>Ø§Ù„ØªØµÙˆÙŠØ¨</th>
                                <th>Ø§Ù„Ø¨ÙŠØ¶Ø§</th>
                                <th>Ø§Ù„Ø¹ØµØ§</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ==========================================
             Ù…Ø­ØªÙˆÙ‰ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª
        ========================================== -->
        <div id="measurementsMode" class="content hidden">
            <div class="card">
                <h2>ğŸ“‹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª</h2>
            </div>

            <div class="filter-section">
                <div class="filter-group">
                    <label for="filterRails">ÙÙ„ØªØ± Ø­Ø³Ø¨ Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†</label>
                    <select id="filterRails">
                        <option value="">Ø§Ù„ÙƒÙ„</option>
                        <option value="1">1 Ø¬Ø¯Ø§Ø±</option>
                        <option value="2">2 Ø¬Ø¯Ø§Ø±</option>
                        <option value="3">3 Ø¬Ø¯Ø±Ø§Ù†</option>
                        <option value="4">4 Ø¬Ø¯Ø±Ø§Ù†</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="searchInput">Ø§Ù„Ø¨Ø­Ø«</label>
                    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª...">
                </div>
            </div>

            <div class="card">
                <div class="table-container">
                    <table id="measurementsTable">
                        <thead>
                            <tr>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª</th>
                                <th>Ø§Ù„Ø¬Ø¯Ø±Ø§Ù†</th>
                                <th>Ø§Ù„ØªØµÙˆÙŠØ¨</th>
                                <th>Ø§Ù„Ø¨ÙŠØ¶Ø§</th>
                                <th>Ø§Ù„Ø¹ØµØ§ Ø§Ù„Ù…ØªÙˆÙ‚Ø¹</th>
                                <th>Ø§Ù„Ø¹ØµØ§ Ø§Ù„ÙØ¹Ù„ÙŠ</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- ==========================================
             Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        ========================================== -->
        <div id="settingsMode" class="content hidden">
            <div class="card">
                <h2>âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
            </div>

            <div class="card">
                <h2>ğŸ’¾ Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯</h2>
                <p style="margin-bottom: 15px; color: #666;">Ø§Ø­ÙØ¸ ÙˆØ§Ø³ØªØ¹Ø¯ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ</p>
                <div class="btn-group">
                    <button type="button" class="btn-primary" id="exportJSONBtn">ØªØµØ¯ÙŠØ± JSON</button>
                    <button type="button" class="btn-primary" id="exportCSVBtn">ØªØµØ¯ÙŠØ± CSV</button>
                    <button type="button" class="btn-secondary" id="importBtn">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
                    <input type="file" id="fileInput" style="display: none;" accept=".json,.csv">
                </div>
            </div>

            <div class="card">
                <h2>âš ï¸ Ø¹Ù…Ù„ÙŠØ§Øª Ø®Ø·Ø±Ø©</h2>
                <p style="margin-bottom: 15px; color: #666;">ØªØ­Ø°ÙŠØ±: Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù‚Ø¯ Ù„Ø§ ØªÙƒÙˆÙ† Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ±Ø§Ø¬Ø¹</p>
                <button type="button" class="btn-danger" id="clearAllBtn">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
            </div>
        </div>
    </div>

    <!-- ØªØ¶Ù…ÙŠÙ† Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© -->
    <script src="../rail-positions-system.js"></script>
    <script src="../measurements-system.js"></script>
    <script src="../core/billiards-engine.js"></script>
    <script src="../services/system-services.js"></script>
    <script>
        // ==========================================
        // Ù…Ù†Ø·Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…ÙˆØ­Ø¯
        // ==========================================

        class UnifiedApp {
            constructor() {
                this.engine = window.billiards;
                this.currentMode = 'calculator';
                this.initUI();
                this.attachEventListeners();
                this.loadTheme();
            }

            /**
             * ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
             */
            initUI() {
                this.updateDashboard();
                this.updateMeasurementsTable();
            }

            /**
             * Ø±Ø¨Ø· Ø­Ø¯Ø«ÙŠØ§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
             */
            attachEventListeners() {
                // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.switchMode(e.target.dataset.mode));
                });

                // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
                document.getElementById('calculateBtn').addEventListener('click', () => this.calculate());
                document.getElementById('addBtn').addEventListener('click', () => this.addMeasurement());
                document.getElementById('clearBtn').addEventListener('click', () => this.clearCalculator());

                // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                document.getElementById('exportJSONBtn').addEventListener('click', () => this.exportJSON());
                document.getElementById('exportCSVBtn').addEventListener('click', () => this.exportCSV());
                document.getElementById('importBtn').addEventListener('click', () => {
                    document.getElementById('fileInput').click();
                });
                document.getElementById('fileInput').addEventListener('change', (e) => this.importData(e));
                document.getElementById('clearAllBtn').addEventListener('click', () => this.clearAllData());

                // Ø§Ù„Ù…Ø±Ø´Ø­Ø§Øª ÙˆØ§Ù„Ø¨Ø­Ø«
                document.getElementById('filterRails').addEventListener('change', () => this.updateMeasurementsTable());
                document.getElementById('searchInput').addEventListener('input', () => this.updateMeasurementsTable());

                // Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
                document.getElementById('themeToggle').addEventListener('click', () => this.toggleTheme());
            }

            /**
             * ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹
             */
            switchMode(mode) {
                this.currentMode = mode;
                document.querySelectorAll('.content').forEach(el => el.classList.add('hidden'));
                document.getElementById(mode + 'Mode').classList.remove('hidden');

                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

                if (mode === 'dashboard') {
                    this.updateDashboard();
                } else if (mode === 'measurements') {
                    this.updateMeasurementsTable();
                }
            }

            /**
             * Ø­Ø³Ø§Ø¨ Ù‚ÙŠØ§Ø³ Ø§Ù„Ø¹ØµØ§
             */
            calculate() {
                const rails = document.getElementById('rails').value;
                const target = parseFloat(document.getElementById('target').value);
                const whiteBall = parseFloat(document.getElementById('whiteBall').value);

                if (!rails || !target || !whiteBall) {
                    this.showAlert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„', 'error');
                    return;
                }

                const cue = this.engine.calculateCue(target, whiteBall);
                const validation = this.engine.validateMeasurement(target, whiteBall, cue);

                document.getElementById('resultValue').textContent = cue.toFixed(1);
                document.getElementById('addBtn').style.display = 'block';

                const msgEl = document.getElementById('validationMessage');
                if (validation.isCorrect) {
                    msgEl.textContent = 'âœ… ØµØ­ÙŠØ­ - Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¥Ø¶Ø§ÙØ©';
                    msgEl.className = 'validation-message validation-correct';
                } else {
                    msgEl.textContent = `âš ï¸ Ø§Ù†Ø­Ø±Ø§Ù: ${validation.error.toFixed(2)}`;
                    msgEl.className = 'validation-message validation-incorrect';
                }
            }

            /**
             * Ø¥Ø¶Ø§ÙØ© Ù‚ÙŠØ§Ø³
             */
            addMeasurement() {
                const rails = document.getElementById('rails').value;
                const target = parseFloat(document.getElementById('target').value);
                const whiteBall = parseFloat(document.getElementById('whiteBall').value);
                const notes = document.getElementById('notes').value;
                const cue = parseFloat(document.getElementById('resultValue').textContent);

                this.engine.addMeasurement({ rails, target, whiteBall, cue, notes });
                this.showAlert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚ÙŠØ§Ø³ Ø¨Ù†Ø¬Ø§Ø­ âœ“', 'success');
                this.clearCalculator();
                this.updateDashboard();
            }

            /**
             * Ù…Ø³Ø­ Ø§Ù„Ø­Ø§Ø³Ø¨Ø©
             */
            clearCalculator() {
                document.getElementById('calculatorForm').reset();
                document.getElementById('resultValue').textContent = '-';
                document.getElementById('validationMessage').textContent = '';
                document.getElementById('addBtn').style.display = 'none';
            }

            /**
             * ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
             */
            updateDashboard() {
                const stats = this.engine.getBasicStatistics();
                const html = `
                    <div class="stat-card">
                        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª</div>
                        <div class="stat-value">${stats.total}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ù‚ÙŠØ§Ø³Ø§Øª ØµØ­ÙŠØ­Ø©</div>
                        <div class="stat-value">${stats.correct}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ù‚ÙŠØ§Ø³Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
                        <div class="stat-value">${stats.incorrect}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Ø¯Ù‚Ø© Ø§Ù„Ù†Ø³Ø¨Ø©</div>
                        <div class="stat-value">${stats.accuracy}%</div>
                    </div>
                `;
                document.getElementById('statsGrid').innerHTML = html;

                // Ø¹Ø±Ø¶ Ø¢Ø®Ø± 5 Ù‚ÙŠØ§Ø³Ø§Øª
                const measurements = this.engine.getAllMeasurements().slice(0, 5);
                const tbody = document.querySelector('#recentTable tbody');
                tbody.innerHTML = measurements.map(m => `
                    <tr>
                        <td>${m.date}</td>
                        <td>${m.rails}</td>
                        <td>${m.target}</td>
                        <td>${m.whiteBall}</td>
                        <td>${m.cue}</td>
                        <td><span class="status-badge ${m.isCorrect ? 'status-correct' : 'status-incorrect'}">
                            ${m.isCorrect ? 'âœ“ ØµØ­ÙŠØ­' : 'âœ— ØºÙŠØ± ØµØ­ÙŠØ­'}
                        </span></td>
                    </tr>
                `).join('');
            }

            /**
             * ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù‚ÙŠØ§Ø³Ø§Øª
             */
            updateMeasurementsTable() {
                const railsFilter = document.getElementById('filterRails').value;
                const searchQuery = document.getElementById('searchInput').value;

                const filtered = this.engine.filterMeasurements(railsFilter, searchQuery);
                const tbody = document.querySelector('#measurementsTable tbody');

                if (filtered.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="9" class="empty-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚ÙŠØ§Ø³Ø§Øª</td></tr>';
                    return;
                }

                tbody.innerHTML = filtered.map(m => `
                    <tr>
                        <td>${m.date} ${m.time}</td>
                        <td>${m.rails}</td>
                        <td>${m.target}</td>
                        <td>${m.whiteBall}</td>
                        <td>${m.expectedCue}</td>
                        <td>${m.cue}</td>
                        <td><span class="status-badge ${m.isCorrect ? 'status-correct' : 'status-incorrect'}">
                            ${m.isCorrect ? 'âœ“ ØµØ­ÙŠØ­' : 'âœ— ØºÙŠØ± ØµØ­ÙŠØ­'}
                        </span></td>
                        <td>${m.notes}</td>
                        <td>
                            <button class="btn-danger" onclick="app.deleteMeasurement(${m.id})">Ø­Ø°Ù</button>
                        </td>
                    </tr>
                `).join('');
            }

            /**
             * Ø­Ø°Ù Ù‚ÙŠØ§Ø³
             */
            deleteMeasurement(id) {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù‚ÙŠØ§Ø³ØŸ')) {
                    this.engine.deleteMeasurement(id);
                    this.showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚ÙŠØ§Ø³', 'info');
                    this.updateMeasurementsTable();
                    this.updateDashboard();
                }
            }

            /**
             * Ø§Ù„ØªØµØ¯ÙŠØ± ÙˆØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
             */
            exportJSON() {
                const data = this.engine.exportToJSON();
                Services.Export.downloadJSON(data);
                this.showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
            }

            exportCSV() {
                const data = this.engine.exportToCSV();
                Services.Export.downloadCSV(data);
                this.showAlert('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'success');
            }

            importData(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const result = this.engine.importFromJSON(e.target.result);
                        if (result.success) {
                            this.showAlert(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${result.count} Ù‚ÙŠØ§Ø³`, 'success');
                            this.updateDashboard();
                            this.updateMeasurementsTable();
                        } else {
                            this.showAlert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯: ' + result.error, 'error');
                        }
                    } catch (error) {
                        this.showAlert('Ø®Ø·Ø£: ' + error.message, 'error');
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            }

            clearAllData() {
                if (this.engine.clearAllData()) {
                    this.showAlert('ØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'info');
                    this.updateDashboard();
                    this.updateMeasurementsTable();
                }
            }

            /**
             * Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
             */
            showAlert(message, type = 'info') {
                Services.Notification.show(message, type, 3000);
            }

            /**
             * ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ
             */
            toggleTheme() {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');
                localStorage.setItem('darkMode', isDark);
            }

            /**
             * ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¸Ù‡Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸
             */
            loadTheme() {
                if (localStorage.getItem('darkMode') === 'true') {
                    document.body.classList.add('dark-mode');
                }
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let app;
        window.addEventListener('DOMContentLoaded', () => {
            // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø¶Ù…Ø§Ù† ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
            setTimeout(() => {
                app = new UnifiedApp();
            }, 500);
        });
    </script>
</body>
</html>
