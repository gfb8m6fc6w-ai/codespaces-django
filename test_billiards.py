"""
اختبارات البلياردو المحسّنة
اختبارات شاملة لجميع الوحدات الرئيسية
"""

import pytest
import sys
from pathlib import Path
import tempfile

# إضافة مسار المشروع
sys.path.insert(0, str(Path(__file__).parent))

from backend.billiards.calculator import ShotCalculator
from backend.billiards.rail_system import RailPositionsSystem
from backend.billiards.engine import BilliardsEngine
from backend.models.shot import Shot, Difficulty
from backend.models.statistics import Statistics\n\n\nclass TestShotCalculator:\n    \"\"\"اختبارات حاسبة التسديقات\"\"\"\n    \n    def setup_method(self):\n        \"\"\"إعداد قبل كل اختبار\"\"\"\n        self.calculator = ShotCalculator()\n    \n    def test_calculate_cue(self):\n        \"\"\"اختبار حساب قيمة العصا\"\"\"\n        cue = self.calculator.calculate_cue(3.5, 2.5)\n        assert cue == 6.0\n    \n    def test_calculate_difficulty_easy(self):\n        \"\"\"اختبار صعوبة سهلة\"\"\"\n        difficulty = self.calculator.calculate_difficulty(1, 2.0, 1.5)\n        assert difficulty == Difficulty.EASY\n    \n    def test_calculate_difficulty_hard(self):\n        \"\"\"اختبار صعوبة صعبة\"\"\"\n        difficulty = self.calculator.calculate_difficulty(4, 6.0, 5.5)\n        assert difficulty in [Difficulty.HARD, Difficulty.VERY_HARD, Difficulty.EXTREME]\n    \n    def test_calculate_success_rate(self):\n        \"\"\"اختبار حساب معدل النجاح\"\"\"\n        rate = self.calculator.calculate_success_rate(1, Difficulty.EASY)\n        assert 80 <= rate <= 100\n        \n        rate = self.calculator.calculate_success_rate(4, Difficulty.EXTREME)\n        assert rate < 20\n    \n    def test_calculate_power_required(self):\n        \"\"\"اختبار حساب القوة المطلوبة\"\"\"\n        power = self.calculator.calculate_power_required(1, 3.0, 2.0)\n        assert 10 <= power <= 100\n    \n    def test_create_shot(self):\n        \"\"\"اختبار إنشاء تسديقة\"\"\"\n        shot = self.calculator.create_shot(2, 5.0, 3.5, 2.0, 3)\n        assert isinstance(shot, Shot)\n        assert shot.rails == 2\n        assert shot.pocket == 3\n\n\nclass TestRailPositionsSystem:\n    \"\"\"اختبارات نظام مواضع الجدران\"\"\"\n    \n    def setup_method(self):\n        \"\"\"إعداد قبل كل اختبار\"\"\"\n        self.rail_system = RailPositionsSystem()\n    \n    def test_get_position(self):\n        \"\"\"اختبار الحصول على موضع\"\"\"\n        pos = self.rail_system.get_position(1, 5.0)\n        assert pos is not None\n        assert pos.position == 5.0\n        assert pos.rail == 1\n    \n    def test_get_all_positions(self):\n        \"\"\"اختبار الحصول على جميع المواضع\"\"\"\n        positions = self.rail_system.get_all_positions(1)\n        assert len(positions) > 0\n    \n    def test_invalid_rails(self):\n        \"\"\"اختبار قيمة جدران غير صحيحة\"\"\"\n        with pytest.raises(ValueError):\n            self.rail_system.get_position(5, 5.0)\n    \n    def test_invalid_position(self):\n        \"\"\"اختبار قيمة موضع غير صحيحة\"\"\"\n        with pytest.raises(ValueError):\n            self.rail_system.get_position(1, 15.0)\n\n\nclass TestShot:\n    \"\"\"اختبارات نموذج التسديقة\"\"\"\n    \n    def test_shot_creation(self):\n        \"\"\"اختبار إنشاء تسديقة\"\"\"\n        shot = Shot(\n            rails=2,\n            cue_position=5.0,\n            white_ball=3.5,\n            target=2.0,\n            pocket=3,\n        )\n        assert shot.rails == 2\n        assert shot.executed == False\n    \n    def test_shot_validation(self):\n        \"\"\"اختبار التحقق من صحة التسديقة\"\"\"\n        with pytest.raises(ValueError):\n            Shot(\n                rails=5,  # غير صحيح\n                cue_position=5.0,\n                white_ball=3.5,\n                target=2.0,\n                pocket=3,\n            )\n    \n    def test_shot_to_dict(self):\n        \"\"\"اختبار تحويل التسديقة إلى قاموس\"\"\"\n        shot = Shot(\n            rails=1,\n            cue_position=5.0,\n            white_ball=3.5,\n            target=2.0,\n            pocket=2,\n        )\n        shot_dict = shot.to_dict()\n        assert shot_dict['rails'] == 1\n        assert shot_dict['pocket'] == 2\n    \n    def test_shot_from_dict(self):\n        \"\"\"اختبار إنشاء تسديقة من قاموس\"\"\"\n        shot_dict = {\n            'rails': 2,\n            'cue_position': 5.0,\n            'white_ball': 3.5,\n            'target': 2.0,\n            'pocket': 3,\n            'difficulty': 'متوسطة',\n            'success_rate': 70.0,\n        }\n        shot = Shot.from_dict(shot_dict)\n        assert shot.rails == 2\n        assert shot.pocket == 3\n\n\nif __name__ == '__main__':\n    pytest.main([__file__, '-v'])\n"